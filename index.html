<!DOCTYPE html>
<html>
    <head>
        <title>モンティホール問題</title>
        <meta charset="UTF-8">
        <style>
            p{
                color: white;
            }
            body{
                background-color: black;
            }
            .door{
                background-color:white;
                width: 50px;
                height: 100px;
            }
        </style>
        <script>
            let maxCount = 10000;
            let ifLoad = 0;
            let totalCount = 0,hitCount = 0;
            let ramdom = function(M,m){return Math.floor(Math.random()*(M-m)+m)};
            let main = function(){
                if(ifLoad ===0){
                    ifLoad++;
                    let loop = setInterval(function(){
                        if(totalCount == (maxCount-1)){
                            clearInterval(loop);
                        }
                        let doorData = [0,0,0];
                        let gem = 0;
                        let choice = 0;
                        let open1 = 0;
                        let open2 = 0;
                        let open = 0;
                        var door = document.getElementsByClassName("door");
                        for(i=0;i<door.length;i++){
                            door[i].style.backgroundColor = "white";
                        }
                        console.log("reset!!");
                        //ここまでreset関連

                        gem = ramdom(3,0);
                        doorData[gem] = doorData[gem] | 0x1;
                        console.log("景品確定後:"+doorData);
                        choice = ramdom(3,0);
                        doorData[choice] = doorData[choice] | 0x2;
                        document.getElementById("door"+(choice+1)).style.backgroundColor = "green";
                        console.log("ドア選択後:"+doorData);
                        open1 = doorData.indexOf(0);
                        open2 = doorData.lastIndexOf(0);
                        if(open1==open2){
                            doorData[open1] = doorData[open1] | 0x4;
                        }
                        else{
                            let i = ramdom(1,3);
                            if(i==1){open = open1};
                            if(i==2){open = open2};
                            doorData[open] = doorData[open] | 0x4;
                        }
                        document.getElementById("door"+(doorData.indexOf(4)+1)).style.backgroundColor = "black";
                        console.log("ドア開け後:"+doorData);
                        if(document.getElementById("type").value == 1){
                            for(let i = 0; i < 3; i++){
                                if((doorData[i] & 0x6) == 0){
                                    doorData[choice] = doorData[choice] & 0x1;
                                    document.getElementById("door"+(choice+1)).style.backgroundColor = "white";
                                    console.log(i+doorData);
                                    choice = i;
                                    doorData[choice] = doorData[choice] | 0x2;
                                    document.getElementById("door"+(choice+1)).style.backgroundColor = "green";
                                    break;
                                }
                            }
                        }
                        console.log("最終選択後:"+doorData);
                        if(gem==choice){
                            document.getElementById("door"+(choice+1)).style.backgroundColor = "orange";
                            hitCount++;
                        }
                        else{
                            document.getElementById("door"+(gem+1)).style.backgroundColor = "red";
                        }
                        totalCount++;
                        let probability = Math.floor((hitCount / totalCount)*10000)/100;
                        document.getElementById("total").textContent = "試行回数:"+totalCount;
                        document.getElementById("hit").textContent = "正解数:"+hitCount;
                        document.getElementById("probability").textContent = "確率:"+probability+"%";
                    },1000/6000)
                }
            }
        </script>
    </head>
    <body>
        <select id="type">
            <option value="0">選択しなおさない</option>
            <option value="1">選択しなおす</option>
        </select>
        <table border="1"  onclick="main()" touchend="main()">
            <tr>
                <td class="door" id="door1"></td>
                <td class="door" id="door2"></td>
                <td class="door" id="door3"></td>
            </tr>
        </table>
        <p id="total"></p>
        <p id="hit"></p>
        <p id="probability"></p>
        <p color="red">※ポリゴンショック注意※</p>
    </body>
</html>
